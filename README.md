# FastCacheMiddleware

–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ middleware –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ FastAPI —Å –≥–∏–±–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üéØ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ dependencies –≤ —Ä–æ—É—Ç–∞—Ö
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ –ø—Ä–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- ‚öôÔ∏è –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª—é—á–µ–π –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–∞–≤–∏–ª –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
- üöÄ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –±—ç–∫–µ–Ω–¥–∞–º–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- üìä –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–µ—Ç—Ä–∏–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
- üîí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é –∫–µ—à–∞ (PUBLIC/PRIVATE)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
poetry add fast-cache-middleware
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```python
from fastapi import FastAPI, Depends
from fast_cache_middleware import CacheConfig, CacheDropConfig, CacheVisibility

app = FastAPI()

@app.get(
    "/data/{id}",
    dependencies=[
        Depends(CacheConfig(
            max_age=300,
            visibility=CacheVisibility.PRIVATE,
            key_func=lambda r: f"data_{r.path_params['id']}"
        ))
    ]
)
async def get_data(id: str):
    return {"id": id, "data": "some_data"}

@app.post(
    "/data/{id}",
    dependencies=[
        Depends(CacheDropConfig(
            paths=["/data/{id}"],
            key_template="data_{id}"
        ))
    ]
)
async def update_data(id: str):
    return {"id": id, "status": "updated"}
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
fast_cache_middleware/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ config.py          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã
‚îú‚îÄ‚îÄ middleware.py      # –û—Å–Ω–æ–≤–Ω–æ–π middleware
‚îú‚îÄ‚îÄ route.py           # –ö–∞—Å—Ç–æ–º–Ω—ã–π APIRoute
‚îú‚îÄ‚îÄ types.py           # –¢–∏–ø—ã –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã
‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ base.py        # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
‚îÇ   ‚îî‚îÄ‚îÄ memory.py      # In-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ key_generator.py  # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –∫–ª—é—á–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ validators.py     # –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
‚îú‚îÄ‚îÄ examples/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ basic.py          # –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ advanced.py       # –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø—Ä–∏–º–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ custom_store.py   # –ü—Ä–∏–º–µ—Ä –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ test_middleware.py
    ‚îú‚îÄ‚îÄ test_stores.py
    ‚îî‚îÄ‚îÄ test_utils.py
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (config.py)

- `CacheConfig` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è GET-–∑–∞–ø—Ä–æ—Å–æ–≤
- `CacheDropConfig` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- `CacheVisibility` - enum –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç—å—é –∫–µ—à–∞

### Middleware (middleware.py)

- `FastCacheMiddleware` - –æ—Å–Ω–æ–≤–Ω–æ–π middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å FastAPI —á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω—ã–π `APIRoute`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∫–µ—à–∞

### –•—Ä–∞–Ω–∏–ª–∏—â–∞ (stores/)

- `BaseCacheStore` - –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â
- `MemoryCacheStore` - in-memory —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –£—Ç–∏–ª–∏—Ç—ã (types.py –∏ –¥—Ä.)

- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –∫–ª—é—á–µ–π –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `examples/`:

- `basic.py` - –±–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ middleware
- `